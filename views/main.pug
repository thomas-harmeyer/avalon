extends layout

block content
    .container.container-small
        .d-flex.justify-content-center
            h1 Pick a #{missionSize} person mission:
        .d-flex.justify-content-center
            .row.justify-content-center.form-group
                for user in users
                    .d-flex.justify-content-center
                        .col
                            a.btn.btn-secondary #{user.username}
        .d-flex.justify-content-center.row
            a#submit.btn.btn-warning send mission
        #missionForm.d-flex.justify-content-center
            .row.justify-content-center
                .col.form-group
                    form(method="post", action="/vote")
                        button.btn.btn-primary.vote(type="submit" name="votePass") Pass
                        .col.form-group
                    form(method="post", action="/vote")
                        button.btn.btn-danger.vote(type="submit" name="voteFail") Fail
                

    script(type="text/javascript").
        $('a').each(function() {
            $(this).click(function() {
                if($(this).hasClass("btn-secondary")){
                    $(this).removeClass("btn-secondary");
                    $(this).addClass("btn-primary");
                }
                else if($(this).hasClass("btn-primary")){
                    $(this).removeClass("btn-primary");
                    $(this).addClass("btn-secondary");
                }
            });
        });
    script(type="text/javascript").
        $("#submit").click(()=>{
            let suggestedUsers = {"users" : [],
            "things":"yes"};
            $("a.btn-primary").each((index,value)=> {
                suggestedUsers.users.push($(value).text());
            });
            $("a.btn-primary").removeClass("btn-primary").addClass("btn-secondary");
            $.ajax({
                method: "POST",
                url: "/main/new_mission",
                data: suggestedUsers,
                success: function (result) 
                {
                    if(result)
                    {
                        location.href = '/main';
                    }
                }
            });
        });
    script(type="text/javascript").
        var isOneMission=false;
        window.onload=()=>{
            $(".vote").hide();
                $.ajax({
                    method: "GET",
                    url: "/main/new_mission",
                    success: function (result) 
                    {
                        if(result==true){
                             $(".vote").show();
                        }
                        console.log(result);
                    }
                });
        };